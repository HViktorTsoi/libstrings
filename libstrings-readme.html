<!DOCTYPE html>
<meta charset="utf-8">
<title>libstrings readme</title>
<style>
    body {
        font:12pt/1.5 Helvetica,sans-serif;
        text-rendering:optimizeLegibility;}
    p, ul, li {margin:1.5em 0;}
    h1,h3,h2 {font-weight:normal;}
h1{
    font-size:36pt;
    line-height:0.5;
    margin-top:1.125em;
    margin-bottom:0.375em;}
h2{
    font-size:24pt;
    line-height:0.75;
    margin-top:3em;
    margin-bottom:1.5em;}
h3{
    font-size:18pt;
    line-height:1;
    margin-top:3.5em;
    margin-bottom:1em;}
    ul, ol {margin-top:0.5em; margin-bottom:1em;}
    li {margin:0.75em 0;}
    a:link {text-decoration:none;}
    a:hover {text-decoration:underline;}
    ol ol {list-style:lower-alpha;}

    code {display:inline-block; padding:0 3px; background:#eee;}
    td, th {border:1px solid #ddd; padding: 5px; vertical-align:top;}
    table {border-collapse:collapse; margin:1.5em; margin-bottom: 3em; background:#fafafa;}
    thead {background:#99CCFF;}
    code.box {border-radius:5px; border:1px solid #ccc; padding:0.75em; white-space:pre; overflow-x:auto; display:table; margin:1.5em;}

    blockquote {border-radius:3px; border:1px solid #0c0; padding:5px; background:#7e7; display:table;margin:1.5em;}

    a[href^="http"]:after {padding-left:2px; content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAVklEQVR4Xn3PgQkAMQhDUXfqTu7kTtkpd5RA8AInfArtQ2iRXFWT2QedAfttj2FsPIOE1eCOlEuoWWjgzYaB/IkeGOrxXhqB+uA9Bfcm0lAZuh+YIeAD+cAqSz4kCMUAAAAASUVORK5CYII=);}

    span[title] {border-bottom: 1px dotted; font-family: sans-serif; cursor:help;}
    abbr {cursor:help;}

    #warning {background:#c00; padding:10px 5px;margin:-8px;}
    var {color:#8B4513;}
    .dfn {display:block; margin-bottom:4.5em; font-style:normal;}
</style>

<!-- libstrings

    A library for reading and writing STRINGS, ILSTRINGS and DLSTRINGS files.

    Copyright (C) 2012    WrinklyNinja

    This file is part of libstrings.

    libstrings is free software: you can redistribute
    it and/or modify it under the terms of the GNU General Public License
    as published by the Free Software Foundation, either version 3 of
    the License, or (at your option) any later version.

    libstrings is distributed in the hope that it will
    be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with libstrings.  If not, see
    <http://www.gnu.org/licenses/>.
-->

<h1>libstrings</h1>
<h2>Contents</h2>
<ol>
    <li><a href="#intro">Introduction</a>
    <li><a href="#types">Variable Types</a>
    <li><a href="#memory">Memory Management</a>
    <li><a href="#codes">Return Codes</a>
    <li><a href="#functions">Functions</a>
    <ol>
        <li><a href="#functions-error">Error Handling Functions</a>
        <li><a href="#functions-version">Version Functions</a>
        <li><a href="#functions-lifecycle">Lifecycle Management Functions</a>
        <li><a href="#functions-read">String Reading Functions</a>
        <li><a href="#functions-write">String Writing Functions</a>
    </ol>
    <li><a href="#example">Example Usage</a>
    <li><a href="#contact">Contact</a>
    <li><a href="#contact">Credits</a>
    <li><a href="#license">License</a>
    <li><a href="#appendix">Appendix: Strings File Encoding</a>
</ol>

<h2 id="intro">Introduction</h2>
<p>libstrings is a free software library for reading and writing TES V: Skyrim's .STRINGS, .ILSTRINGS and .DLSTRINGS files. Its main features are:
<ul>
    <li>C frontend.
    <li>Available as x86 and x64 static and dynamic libraries.
    <li>Read/Write the entire contents of a strings file.
    <li>Read/Edit/Add individual strings within a strings file.
    <li>Get a list of all strings in a strings file that have no associated IDs.
    <li>Automatically clean strings files of all strings with no associated IDs.
    <li>Free and open source software licensed under the GNU General Public License v3.0.
</ul>
<p>libstrings is designed to free modding utility developers from the task of implementing their own code for the functionality it provides.
<p><strong>Note</strong>: libstrings is <strong>not</strong> thread safe. Thread safety is a goal, but one that has not yet been achieved. Bear this in mind if using it in a multi-threaded client.


<h2 id="types">Variable Types</h2>
<p>libstrings uses character strings and integers for data input/output.
<ul>
    <li>All strings are null-terminated byte character strings encoded in UTF-8.
    <li>All codes are unsigned integers at least 16 bits in size.
    <li>All array sizes are unsigned integers at least 16 bits in size.
    <li>File paths are case-sensitive if and only if the underlying file system is case-sensitive.
</ul>
<p>libstrings also introduces two new structures:
<code class="box" id="game_handle">typedef struct _strings_handle_int * st_strings_handle;</code>
<p>The <code>st_strings_handle</code> structure abstracts the definition of libstrings' internal state while still providing type safety across the library's functions.
<code class="box" id="strings_data">typedef struct {
    uint32_t id;
    char * data;
} st_string_data;</code>
<p>The <code>st_string_data</code> structure is provided to ensure that strings, given by <var>data</var>, and their IDs, given by <var>id</var>, do not get mixed up with one another.


<h2 id="memory">Memory Management</h2>
<p>libloadorder manages the memory of strings and arrays it returns internally, so such strings and arrays should not be deallocated by the client.
<p>Data returned by a function lasts until a function is called which returns data of the same type (eg. a string is stored until the client calls another function which returns a string, an integer array lasts until another integer array is returned, etc.).
<p>All allocated memory is freed when <a href="#st_close">st_close</a> is called, except the string allocated by <a href="#st_get_error_message">st_get_error_message</a>, which must be freed by calling <a href="#st_cleanup">st_cleanup</a>.


<h2 id="codes">Return Codes</h2>
<p>The following codes are used to signal how a function completes. When a function exits prematurely, a reversal of changes made during its prior execution is attempted.
<table>
    <thead><tr><th>Return Code<th>Description
    <tbody>
        <tr><td>LIBSTRINGS_OK                               <td>The function completed successfully.
        <tr><td>LIBSTRINGS_ERROR_BAD_STRING               <td>The given string cannot be encoded in Windows-1252.
        <tr><td>LIBSTRINGS_ERROR_FILE_READ_FAIL         <td>A file could not be read.
        <tr><td>LIBSTRINGS_ERROR_FILE_WRITE_FAIL            <td>A file could not be written to.
        <tr><td>LIBSTRINGS_ERROR_NO_MEM                 <td>The library was unable to allocate the required memory.
        <tr><td>LIBSTRINGS_ERROR_INVALID_ARGS               <td>Invalid arguments were given for the function.
        <tr><td>LIBSTRINGS_RETURN_MAX                       <td>Matches the value of the highest-numbered return code. Provided in case clients wish to incorporate additional return codes in their implementation and desire some method of avoiding value conflicts.
</table>



<h2 id="functions">Functions</h2>
<p>libstrings provides the functions listed below to clients. Where a function returns a unsigned int value, this is the function's return code.

<h3 id="functions-error">Error Handling Functions</h3>
<div class="dfn" id="st_get_error_message">
<code class="box">unsigned int st_get_error_message (const char ** const details);</code>
<p>Outputs a string giving the details of the last time an error or warning return code was returned by a function.
<ul>
    <li><var>details</var> - A pointer to the error details string outputted by the function.
</ul>
</div>
<div class="dfn" id="st_cleanup">
<code class="box">void st_cleanup ();</code>
<p>Frees the memory allocated to the last error details string.
<ul>
    <li><var>details</var> - A pointer to the error details string outputted by the function.
</ul>
</div>

<h3 id="functions-version">Version Functions</h3>
<div class="dfn" id="st_is_compatible">
<code class="box">bool st_is_compatible</a> (const unsigned int versionMajor,
                       const unsigned int versionMinor,
                       const unsigned int versionPatch);</code>
<p>Returns whether this version of libstrings is compatible with the given version of libstrings. Abstracts library stability policy away from clients.
<ul>
    <li><var>versionMajor</var> - The major version number (<b>major</b>.minor.patch) to check.
    <li><var>versionMinor</var> - The minor version number (major.<b>minor</b>.patch) to check.
    <li><var>versionPatch</var> - The patch version number (major.minor.<b>patch</b>) to check.
</ul>
</div>
<div class="dfn" id="st_get_version">
<code class="box">unsigned int st_get_version (unsigned int * const versionMajor,
                             unsigned int * const versionMinor,
                             unsigned int * const versionPatch);</code>
<p>Returns the version numbers for the loaded version of libstrings.
<ul>
    <li><var>versionMajor</var> - A pointer to the major version number (<b>major</b>.minor.patch).
    <li><var>versionMinor</var> - A pointer to the minor version number (major.<b>minor</b>.patch).
    <li><var>versionPatch</var> - A pointer to the patch version number (major.minor.<b>patch</b>).
</ul>
</div>

<h3 id="functions-lifecycle">Lifecycle Management Functions</h3>
<div class="dfn" id="st_open">
<code class="box">unsigned int st_open (st_strings_handle * const sh,
                      const char * const path,
                      const char * const fallbackEncoding);</code>
<p>Opens a STRINGS, ILSTRINGS or DLSTRINGS file, outputting a handle for the strings it contains. If the file doesn't exist then a handle for a new file will be created. You can create multiple handles.
<ul>
    <li><var>sh</var> - A pointer to the handle created by the function.
    <li><var>path</var> - A string containing the relative or absolute path to the strings file to be opened. The file extension must be one of <code>.STRINGS</code>, <code>.DLSTRINGS</code> or <code>.ILSTRINGS</code>.
    <li><var>fallbackEncoding</var> - The encoding that should be used to interpret any strings in the file that are not valid UTF-8 strings. Accepted values are <code>Windows-1250</code>, <code>Windows-1251</code> and <code>Windows-1252</code>.
</ul>
</div>
<div class="dfn" id="st_save">
<code class="box">unsigned int st_save (st_strings_handle sh,
                      const char * const path,
                      const char * const encoding);</code>
<p>Saves the strings associated with the given handle to the given path, using the given encoding. Duplicate string entries are skipped, as are any unreferenced strings. If a file is loaded then saved by libstrings, the order of its contents may not match their order in the original file. This does not affect Skyrim's handling of the files, as the order does not matter.
<ul>
    <li><var>sh</var> - The handle the function acts on.
    <li><var>path</var> - A string containing the relative or absolute path to the strings file to be saved to. The file extension must be one of <code>.STRINGS</code>, <code>.DLSTRINGS</code> or <code>.ILSTRINGS</code>.
    <li><var>encoding</var> - The encoding in which strings should be written. Accepted values are <code>UTF-8</code>, <code>Windows-1250</code>, <code>Windows-1251</code> and <code>Windows-1252</code>.
</ul>
</div>
<div class="dfn" id="st_close">
<code class="box">void st_close (st_strings_handle sh);</code>
<p>Closes the file associated with the given handle, freeing any memory allocated during its use.
<ul>
    <li><var>sh</var> - The handle to be destroyed.
</ul>
</div>

<h3 id="functions-read">String Reading Functions</h3>

<div class="dfn" id="st_get_strings">
<code class="box">unsigned int st_get_strings (st_strings_handle sh,
                             string_data ** const strings,
                             size_t * const numStrings);</code>
<p>Gets an array of all strings with assigned IDs, that are associated with the given handle.
<ul>
    <li><var>sh</var> - The handle the function acts on.
    <li><var>strings</var> - The outputted array of strings. If <var>numStrings</var> is 0, this will be <code>NULL</code>.
    <li><var>numStrings</var> - The size of the outputted <var>strings</var> array.
</ul>
</div>
<div class="dfn" id="st_get_unref_strings">
<code class="box">unsigned int st_get_unref_strings (st_strings_handle sh,
                                   char *** const strings,
                                   size_t * const numStrings);</code>
<p>Gets an array of strings that were present in the file opened with the given handle but that did not have IDs assigned to them.
<ul>
    <li><var>sh</var> - The handle the function acts on.
    <li><var>strings</var> - The outputted array of strings. If <var>numStrings</var> is 0, this will be <code>NULL</code>.
    <li><var>numStrings</var> - The size of the <var>plugins</var> array.
</ul>
</div>
<div class="dfn" id="st_get_string">
<code class="box">unsigned int st_get_string (st_strings_handle sh,
                            const uint32_t stringId,
                            const char ** const string);</code>
<p>Gets the string with the given ID. If no string is found with that ID, the function returns an error code.
<ul>
    <li><var>sh</var> - The handle the function acts on.
    <li><var>stringId</var> - The ID for which to return the associated string.
    <li><var>string</var> - The outputted string with ID given by <var>id</var>. If no string with that ID is found, this will be <code>NULL</code>.
</ul>
</div>

<h3 id="functions-write">String Writing Functions</h3>
<div class="dfn" id="st_set_strings">
<code class="box">unsigned int st_set_strings (st_strings_handle sh,
                             const st_string_data * const strings,
                             const size_t numStrings);</code>
<p>Replaces all strings, (excluding unreferenced strings) and IDs currently associated with the given handle with the given strings and IDs.
<ul>
    <li><var>sh</var> - The handle the function acts on.
    <li><var>strings</var> - The inputted array of strings.
    <li><var>numStrings</var> - The size of the <var>strings</var> array.
</ul>
</div>
<div class="dfn" id="st_add_string">
<code class="box">unsigned int st_add_string (st_strings_handle sh,
                            const uint32_t stringId,
                            const char * const str);</code>
<p>Adds the given string to the set of strings associated with the given handle, giving it the given ID.
<ul>
    <li><var>sh</var> - The handle the function acts on.
    <li><var>stringId</var> - The ID to be given to the added string. This ID must not already be present in the strings handle, or the function will return an error code.
    <li><var>str</var> - The string to be added.
</ul>
</div>
<div class="dfn" id="st_replace_string">
<code class="box">unsigned int st_replace_string (st_strings_handle sh,
                                const uint32_t stringId,
                                const char * const newString);</code>
<p>Replaces the string associated with the given ID with the given string. If no string with that ID is found, the function returns an error code.
<ul>
    <li><var>sh</var> - The handle the function acts on.
    <li><var>stringId</var> - The ID of the string to be replaced.
    <li><var>newString</var> - The replacement string.
</ul>
</div>
<div class="dfn" id="st_remove_string">
<code class="box">unsigned int st_remove_string (st_strings_handle sh,
                               const uint32_t stringId);</code>
<p>Removes the string associated with the given ID. If no string with that ID is found, the function returns an error code.
<ul>
    <li><var>sh</var> - The handle the function acts on.
    <li><var>stringId</var> - The ID of the string to be removed.
</ul>
</div>

<h2 id="example">Example Usage</h2>
<p>The source code of the <code>libstrings-tester</code> application provides a very simple example of libstrings usage, using the library's C interface directly. The source code for <code>libstrings-tester</code> is hosted alongside the libstrings source code.

<h2 id="contact">Contact</h2>
<p>libstrings has a repository at <a href="https://github.com/WrinklyNinja/libstrings">GitHub</a>. Queries may be made there.

<h2 id="credits">Credits</h2>
<p>Thanks go to Lojack and Mardoxx for their input during the investigation into string file encodings, and to Tokc.D.K. for helping to test the Russian string files.
<p>libstrings is written by WrinklyNinja. libstrings is written in C/C++ and makes use of some of the <a href="http://www.boost.org/">Boost</a> libraries.

<h2 id="license">License</h2>
<p>libstrings is distributed under the <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License v3.0</a>. For the full text of the license, see the included <q>LICENSE</q> file.
