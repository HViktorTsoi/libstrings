<!DOCTYPE html>
<meta charset="utf-8">
<title>libstrings readme</title>
<style>
	body {font-family:Helvetica,sans-serif;font-size:10pt;}
	h1 + p {text-align:center;}
	li {margin-bottom:10px;}
	li ul, li ol {margin-top:0.4em;}
	q {font-style:italic;}
	code {display:inline-block; padding:2px 5px; background:#eee;}
	td, th {border:1px solid #ddd; padding: 5px; vertical-align:top;}
	table {border-collapse:collapse; margin:1em;background:#FafaFf;}
	thead {font-weight:bold;background:#99CCFF;}
	code.box {line-height:20px; white-space:pre; margin:1em 0 0 3em; display:table; padding:5px 10px;}
	ol li ol {list-style:lower-alpha;}
	ol li ol li ol {list-style:lower-roman;}
 ol ol li {margin-bottom:0.2em;}
	blockquote {background:#E6E6FA; display:table; padding:5px 30px 5px 10px;}
	h1 {text-align:center;font-size:24pt;}
	h2 {margin-top:3em;font-size:20pt;}
	h3 {margin-top:2em;font-size:16pt;}
	h4 {margin-top:2em;font-size:12pt;}
	a:link {text-decoration:none;}
	a:hover {text-decoration:underline;}
	a[href^="http"]:after {padding-left:2px; content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAVklEQVR4Xn3PgQkAMQhDUXfqTu7kTtkpd5RA8AInfArtQ2iRXFWT2QedAfttj2FsPIOE1eCOlEuoWWjgzYaB/IkeGOrxXhqB+uA9Bfcm0lAZuh+YIeAD+cAqSz4kCMUAAAAASUVORK5CYII=);}
	
	ul.errorMessages > li {margin-bottom:1.4em;}
	td.t {background:#90ff90;text-align:center;}
	td.c {background:#ff9090;text-align:center;}
	td.t:after {content: '\2713';}
	td.c:after {content: '\2717';}
	img {border:0;}
	.slideshow img {opacity:0; 
		position:absolute;
		transition: opacity 1.5s;
		-moz-transition: opacity 1.5s;
		-webkit-transition: opacity 1.5s;
		-o-transition: opacity 1.5s;}
	.slideshow img:first-child {opacity:1;}
	figcaption {font-style:italic; margin-bottom:2em;}
	tr.inactive {color:#888;}
 tr.inactive td.c, tr.inactive td.t {background:#E3E3E3;}
	code.box {margin-left:0em;}
	span[title] {border-bottom: 1px dotted; font-family: sans-serif; cursor:help;}
	dt {margin-bottom:0.5em; margin-top:1em; font-style:italic;}
	dd {margin-bottom:0.8em;}
	abbr {cursor:help;}
	
	ul {margin-bottom:2em;}
</style>

<!-- libstrings

	A library for reading and writing STRINGS, ILSTRINGS and DLSTRINGS files.

    Copyright (C) 2012    WrinklyNinja

	This file is part of libstrings.

    libstrings is free software: you can redistribute 
	it and/or modify it under the terms of the GNU General Public License 
	as published by the Free Software Foundation, either version 3 of 
	the License, or (at your option) any later version.

    libstrings is distributed in the hope that it will 
	be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with libstrings.  If not, see 
	<http://www.gnu.org/licenses/>.
-->

<h1>libstrings</h1>
<h2>Contents</h2>
<ol>
	<li><a href="#intro">Introduction</a>
	<li><a href="#types">Variable Types</a>
	<li><a href="#memory">Memory Management</a>
	<li><a href="#codes">Return Codes</a>
	<li><a href="#functions">Functions</a>
	<ol>
		<li><a href="#functions-error">Error Handling Functions</a>
		<li><a href="#functions-version">Version Functions</a>
		<li><a href="#functions-lifecycle">Lifecycle Management Functions</a>
		<li><a href="#functions-read">String Reading Functions</a>
		<li><a href="#functions-write">String Writing Functions</a>
	</ol>
	<li><a href="#example">Example Usage</a>
	<li><a href="#contact">Contact</a>
	<li><a href="#contact">Credits</a>
	<li><a href="#license">License</a>
</ol>

<h2 id="intro">Introduction</h2>
<p>libstrings is a free software library for reading and writing TES V: Skyrim's .STRINGS, .ILSTRINGS and .DLSTRINGS files. Its main features are:
<ul>
	<li>C frontend.
	<li>Available as x86 and x64 static and dynamic libraries.
	<li>Read/Write the entire contents of a strings file.
	<li>Read/Edit/Add individual strings within a strings file.
	<li>Get a list of all strings in a strings file that have no associated IDs.
	<li>Automatically clean strings files of all strings with no associated IDs.
	<li>Free and open source software licensed under the GNU General Public License v3.0.
</ul>
<p>libstrings is designed to free modding utility developers from the task of implementing their own code for the functionality it provides. It is one component of the <q>Community Mod Utility Libraries</q>, and can be found <a href="https://github.com/WrinklyNinja/libstrings">on GitHub</a>.
<p><strong>Note</strong>: libstrings is <strong>not</strong> thread safe. Thread safety is a goal, but one that has not yet been achieved. Bear this in mind if using it in a multi-threaded client.


<h2 id="types">Variable Types</h2>
<p>libstrings uses character strings and integers for data input/output. 
<ul>
	<li>All strings are unsigned 8-bit character strings (uint8_t*) encoded in UTF-8 and are null-terminated.
	<li>All codes are unsigned 32-bit integers (uint32_t).
	<li>All array sizes and positions use the unsigned data type size_t.
	<li>File paths are case-sensitive if and only if the underlying file system is case-sensitive.
</ul>
<p>libstrings also introduces two new structures:
<code class="box" id="game_handle">typedef struct strings_handle_int * strings_handle;</code>
<p>The strings_handle structure abstracts the definition of libstrings' internal state while still providing type safety across the library's functions.
<code class="box" id="strings_data">typedef struct {
	uint32_t id;
	uint8_t * data;
} string_data;</code>
<p>The <var>string_data</var> structure is provided to ensure that strings, given by <var>data</var>, and their IDs, given by <var>id</var>, do not get mixed up with one another.


<h2 id="memory">Memory Management</h2>
<p>libstrings manages the memory of strings and arrays it returns internally, so such strings and arrays should not be deallocated by the client.
<p>A string or array outputted by libstrings lasts until the next call to a function which outputs data of the same type, eg. a string will last until a function outputting a string is called. <a href="#CloseStringsFile">CloseStringsFile</a> will also destroy all outputted strings and arrays.
<p>The one exception to the above is the string outputted by <a href="#GetLastErrorDetails">GetLastErrorDetails</a>. This string is allocated independently of all other strings, so lasts until the next call to <a href="#GetLastErrorDetails">GetLastErrorDetails</a> or until <a href="#CleanUpErrorDetails">CleanUpErrorDetails</a> is called. It is not destroyed by <a href="#CloseStringsFile">CloseStringsFile</a>.


<h2 id="codes">Return Codes</h2>
<p>libstrings functions use the following uint32_t return codes to signal how a function completes. When a function exits prematurely, a reversal of changes made during its prior execution is attempted.
<table>
	<thead><tr><th>Return Code<th>Description
	<tbody>
		<tr><td>LIBSTRINGS_OK								<td>The function completed successfully.
		<tr><td>LIBSTRINGS_ERROR_BAD_FILENAME				<td>A UTF-8 string contains characters that do not have Windows-1251/1252 code points, or vice versa.
		<tr><td>LIBSTRINGS_ERROR_FILE_READ_FAIL			<td>A file could not be read.
		<tr><td>LIBSTRINGS_ERROR_FILE_WRITE_FAIL			<td>A file could not be written to.
		<tr><td>LIBSTRINGS_ERROR_NO_MEM					<td>The library was unable to allocate the required memory.
		<tr><td>LIBSTRINGS_ERROR_INVALID_ARGS				<td>Invalid arguments were given for the function.
		<tr><td>LIBSTRINGS_RETURN_MAX						<td>Matches the value of the highest-numbered return code. Provided in case clients wish to incorporate additional return codes in their implementation and desire some method of avoiding value conflicts.
</table>



<h2 id="functions">Functions</h2>
<p>libstrings provides the functions listed below to clients. Where a function returns a uint32_t value, this is the function's return code.

<h3 id="functions-error">Error Handling Functions</h3>
<dfn id="GetLastErrorDetails">GetLastErrorDetails</dfn> - Outputs a string giving the details of the last time an error or warning return code was returned by a function.
<code class="box">uint32_t <a href="#GetLastErrorDetails">GetLastErrorDetails</a> (uint8_t ** details);</code>
<ul>
	<li><var>details</var> - A pointer to the error details string outputted by the function.
</ul>

<dfn id="CleanUpErrorDetails">CleanUpErrorDetails</dfn> - Frees the memory allocated to the last error details string.
<code class="box">void <a href="#CleanUpErrorDetails">CleanUpErrorDetails</a> ();</code>
<ul>
	<li><var>details</var> - A pointer to the error details string outputted by the function.
</ul>

<h3 id="functions-version">Version Functions</h3>
<dfn id="IsCompatibleVersion">IsCompatibleVersion</dfn> - Returns whether this version of libstrings is compatible with the given version of libstrings. Abstracts library stability policy away from clients.
<code class="box">bool <a href="#IsCompatibleVersion">IsCompatibleVersion</a> (const uint32_t bossVersionMajor, const uint32_t bossVersionMinor, const uint32_t bossVersionPatch);</code>
<ul>
	<li><var>versionMajor</var> - The major version number (<b>major</b>.minor.patch) of the library version the client's code was written for.
	<li><var>versionMinor</var> - The minor version number (major.<b>minor</b>.patch) of the library version the client's code was written for.
	<li><var>versionPatch</var> - The patch version number (major.minor.<b>patch</b>) of the library version the client's code was written for.
</ul>

<dfn id="GetVersionNums">GetVersionNums</dfn> - Returns the version numbers for the loaded version of libstrings.
<code class="box">uint32_t <a href="#GetVersionNums">GetVersionNums</a> (uint32_t * versionMajor, uint32_t * versionMinor, uint32_t * versionPatch);</code>
<ul>
	<li><var>versionMajor</var> - The major version number (<b>major</b>.minor.patch) of the library.
	<li><var>versionMinor</var> - The minor version number (major.<b>minor</b>.patch) of the library.
	<li><var>versionPatch</var> - The patch version number (major.minor.<b>patch</b>) of the library.
</ul>

<h3 id="functions-lifecycle">Lifecycle Management Functions</h3>
<dfn id="CreateGameHandle">OpenStringsFile</dfn> - Opens a STRINGS, ILSTRINGS or DLSTRINGS file, outputting a handle for the strings it contains. If the file doesn't exist then a handle for a new file will be created. You can create multiple handles, including for the same file, but remember that libstrings is not thread safe.
<code class="box">uint32_t <a href="#OpenStringsFile">CreateGameHandle</a> (strings_handle * sh, const uint8_t * path);</code>
<ul>
	<li><var>sh</var> - A pointer to the handle created by the function.
	<li><var>path</var> - A string containing the relative or absolute path to the strings file to be opened. The file extension must be one of <code>.STRINGS</code>, <code>.DLSTRINGS</code> or <code>.ILSTRINGS</code>.
</ul>

<dfn id="SaveStringsFile">SaveStringsFile</dfn> - Saves the strings associated with the given handle to the given path.
<p>Note that if a file is loaded then saved by libstrings, the order of strings and directory entries within the file may not match their order in the original file. This does not affect Skyrim's handling of the files, as the order does not matter to it. Also note that libstrings will automatically clean out any unreferenced strings when it saves a file. This can be avoided by getting an array of such strings using GetUnreferencedStrings then assigning them IDs and adding them back in.
<code class="box">uint32_t <a href="#SaveStringsFile">SaveStringsFile</a> (strings_handle sh, const uint8_t * path);</code>
<ul>
	<li><var>sh</var> - The handle the function acts on.
	<li><var>path</var> - A string containing the relative or absolute path to the strings file to be saved to. The file extension must be one of <code>.STRINGS</code>, <code>.DLSTRINGS</code> or <code>.ILSTRINGS</code>.
</ul>

<dfn id="CloseStringsFile">CloseStringsFile</dfn> - Closes the file associated with the given handle, freeing any memory allocated during its use.
<code class="box">void <a href="#CloseStringsFile">CloseStringsFile</a> (game_handle sh, const uint8_t * path, const bool save);</code>
<ul>
	<li><var>sh</var> - The handle to be destroyed.
</ul>


<h3 id="functions-read">String Reading Functions</h3>

<dfn id="GetStrings">GetStrings</dfn> - Gets an array of all strings with assigned IDs, that are associated with the given handle.
<code class="box">uint32_t <a href="#GetStrings">GetStrings</a> (strings_handle sh, string_data ** strings, size_t * numStrings);</code>
<ul>
	<li><var>sh</var> - The handle the function acts on.
	<li><var>strings</var> - The outputted array of strings. If <var>numStrings</var> is 0, this will be <code>NULL</code>.
	<li><var>numStrings</var> - The size of the outputted <var>strings</var> array.
</ul>

<dfn id="GetUnreferencedStrings">GetUnreferencedStrings</dfn> - Gets an array of strings that were present in the file opened with the given handle but that did not have IDs assigned to them.
<code class="box">uint32_t <a href="#GetUnreferencedStrings">GetUnreferencedStrings</a> (strings_handle sh, uint8_t *** strings, size_t * numStrings);</code>
<ul>
	<li><var>sh</var> - The handle the function acts on.
	<li><var>strings</var> - The outputted array of strings. If <var>numStrings</var> is 0, this will be <code>NULL</code>.
	<li><var>numStrings</var> - The size of the <var>plugins</var> array.
</ul>

<dfn id="GetString">GetString</dfn> - Gets the string with the given ID. If no string is found with that ID, the function returns an error code.
<code class="box">uint32_t <a href="#GetString">GetString</a> (strings_handle sh, const uint32_t stringId, const uint8_t ** string);</code>
<ul>
	<li><var>gh</var> - The handle the function acts on.
	<li><var>id</var> - The ID for which to return the associated string.
	<li><var>string</var> - The outputted string with ID given by <var>id</var>. If no string with that ID is found, this will be <code>NULL</code>.
</ul>

<h3 id="functions-write">String Writing Functions</h3>

<dfn id="SetStrings">SetStrings</dfn> - Replaces all strings, (excluding unreferenced strings) and IDs currently associated with the given handle with the given strings and IDs. 
<code class="box">uint32_t <a href="#SetStrings">SetStrings</a> (strings_handle sh, const string_data * strings, const size_t numStrings);</code>
<ul>
	<li><var>sh</var> - The handle the function acts on.
	<li><var>strings</var> - The inputted array of strings.
	<li><var>numStrings</var> - The size of the <var>strings</var> array.
</ul>

<dfn id="AddString">AddString</dfn> - Adds the given string to the set of strings associated with the given handle, giving it the given ID.
<code class="box">uint32_t <a href="#AddString">AddString</a> (strings_handle sh, const uint32_t stringId, const uint8_t * str);</code>
<ul>
	<li><var>sh</var> - The handle the function acts on.
	<li><var>stringId</var> - The ID to be given to the added string. This ID must not already be present in the strings handle, or the function will return an error code.
	<li><var>str</var> - The string to be added.
</ul>

<dfn id="EditString">EditString</dfn> - Replaces the string associated with the given ID with the given string. If no string with that ID is found, the function returns an error code.
<code class="box">uint32_t <a href="#EditString">EditString</a> (strings_handle sh, const uint32_t stringId, const uint8_t * newString);</code>
<ul>
	<li><var>sh</var> - The handle the function acts on.
	<li><var>stringId</var> - The ID of the string to be replaced.
	<li><var>newString</var> - The replacement string.
</ul>

<dfn id="RemoveString">RemoveString</dfn> - Removes the string associated with the given ID. If no string with that ID is found, the function returns an error code.
<code class="box">uint32_t <a href="#RemoveString">RemoveString</a> (strings_handle sh, const uint32_t stringId);</code>
<ul>
	<li><var>sh</var> - The handle the function acts on.
	<li><var>stringId</var> - The ID of the string to be removed.
</ul>


<h2 id="example">Example Usage</h2>
<p>The source code of the <code>libstrings-tester</code> application provides a very simple example of libstrings usage, using the library's C interface directly. The source code for <code>libstrings-tester</code> is hosted alongside the libstrings source code.
<p>More complex usage examples are to follow.

<h2 id="contact">Contact</h2>
<p>libstrings is developed by <a href="https://github.com/terrible-with-names">Terrible With Names</a>. Team members may be available for contact on GitHub, or through Private Messages on Bethesda Softworks' <a href="http://forums.bethsoft.com">official forums</a>.

<h2 id="credits">Credits</h2>
<p>libstrings is written by WrinklyNinja. libstrings is written in C/C++ and makes use of the <a href="http://utfcpp.sourceforge.net/">UTF8-CPP</a> library and some of the <a href="http://www.boost.org/">Boost</a> libraries.

<h2 id="license">License</h2>
<p>libstrings is distributed under the <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License v3.0</a>. For the full text of the license, see the included <q>LICENSE</q> file.